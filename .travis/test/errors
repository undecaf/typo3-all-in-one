# Returns success if a certain error message ($1) is generated at stderr
# by a command ($2, ...).
verify_error() {
    echo "verify_error $1"

    local MSG
    local CMD
    MSG=$1
    CMD=$2
    shift 2

    $CMD "$@" 2>&1 >/dev/null | grep -q -F "$MSG"
}

echo $'\n*************** Error handling'
verify_error 'Missing command' ./t3
verify_error 'Unknown command' ./t3 nosuchcommand
verify_error 'No option was found' ./t3 env
verify_error 'Container engine' ./t3 run -e nosuchengine
verify_error 'Invalid option' ./t3 run -k missingcertfile
verify_error 'Unknown database' ./t3 run -d nosuchdatabase
verify_error 'is required' ./t3 mount --
verify_error 'is required' ./t3 unmount --
